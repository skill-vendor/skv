# Happy path: init -> add -> sync

mkdir workspace
cd workspace
exec skv init

exec git -C skillrepo -c init.defaultBranch=main init
exec git -C skillrepo add .
exec git -C skillrepo commit -m add-skill

exec skv add file://$WORK/workspace/skillrepo:skills/skill-foo
exec skv sync

# Assert vendored content exists.
exists .skv/skills/skill-foo/SKILL.md

# Assert symlinks point to vendored skill.
exec readlink .codex/skills/skill-foo
stdout '^\.\./\.\./\.skv/skills/skill-foo$'
exec readlink .claude/skills/skill-foo
stdout '^\.\./\.\./\.skv/skills/skill-foo$'
exec readlink .opencode/skill/skill-foo
stdout '^\.\./\.\./\.skv/skills/skill-foo$'

lockcmp skv.lock expected.lock.tmpl repo=skillrepo checksum=.skv/skills/skill-foo

-- workspace/skillrepo/skills/skill-foo/SKILL.md --
---
name: skill-foo
description: demo skill
---
-- workspace/skillrepo/LICENSE --
MIT License

Copyright (c) 2000 Example
-- workspace/expected.lock.tmpl --
{
  "skills": [
    {
      "name": "skill-foo",
      "repo": "__REPO__",
      "path": "skills/skill-foo",
      "commit": "__COMMIT__",
      "checksum": "__CHECKSUM__",
      "license": {
        "spdx": "MIT",
        "path": "LICENSE"
      }
    }
  ]
}
