# Full spec with multiple skills and tool exclusion.

mkdir workspace
cd workspace
exec skv init
render skv.cue.tmpl skv.cue repo=skillrepo

exec git -C skillrepo -c init.defaultBranch=main init
exec git -C skillrepo add .
exec git -C skillrepo commit -m add-skills

exec skv sync

# Assert vendored content exists.
exists .skv/skills/skill-alpha/SKILL.md
exists .skv/skills/skill-bravo/SKILL.md
exists .skv/skills/skill-alpha/docs/guide.md
exists .skv/skills/skill-alpha/subdir/more.txt

# Assert symlinks for supported tools.
exec readlink .codex/skills/skill-alpha
stdout '^\.\./\.\./\.skv/skills/skill-alpha$'
exec readlink .codex/skills/skill-bravo
stdout '^\.\./\.\./\.skv/skills/skill-bravo$'
exec readlink .claude/skills/skill-alpha
stdout '^\.\./\.\./\.skv/skills/skill-alpha$'
exec readlink .claude/skills/skill-bravo
stdout '^\.\./\.\./\.skv/skills/skill-bravo$'

# Assert opencode links are excluded.
! exists .opencode/skill/skill-alpha
! exists .opencode/skill/skill-bravo

lockcmp skv.lock expected.lock.tmpl repo=skillrepo checksum.alpha=.skv/skills/skill-alpha checksum.bravo=.skv/skills/skill-bravo

-- workspace/skillrepo/skills/alpha/SKILL.md --
---
name: skill-alpha
description: alpha skill
---
-- workspace/skillrepo/skills/bravo/SKILL.md --
---
name: skill-bravo
description: bravo skill
---
-- workspace/skillrepo/skills/alpha/notes.txt --
alpha content
-- workspace/skillrepo/skills/alpha/docs/guide.md --
alpha docs
-- workspace/skillrepo/skills/alpha/subdir/more.txt --
alpha subdir
-- workspace/skillrepo/skills/bravo/notes.txt --
bravo content
-- workspace/skillrepo/LICENSE --
MIT License

Copyright (c) 2000 Example
-- workspace/skv.cue.tmpl --
skv: {
  tools: {
    exclude: ["opencode"]
  }
  skills: [
    {
      name: "skill-alpha"
      repo: "__REPO__"
      path: "skills/alpha"
      ref: "main"
    },
    {
      name: "skill-bravo"
      repo: "__REPO__"
      path: "skills/bravo"
    },
  ]
}
-- workspace/expected.lock.tmpl --
{
  "skills": [
    {
      "name": "skill-alpha",
      "repo": "__REPO__",
      "path": "skills/alpha",
      "ref": "main",
      "commit": "__COMMIT__",
      "checksum": "__CHECKSUM_ALPHA__",
      "license": {
        "spdx": "MIT",
        "path": "LICENSE"
      }
    },
    {
      "name": "skill-bravo",
      "repo": "__REPO__",
      "path": "skills/bravo",
      "commit": "__COMMIT__",
      "checksum": "__CHECKSUM_BRAVO__",
      "license": {
        "spdx": "MIT",
        "path": "LICENSE"
      }
    }
  ]
}
